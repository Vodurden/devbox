---
- include: "debian.yml"
  when: ansible_distribution == "Debian"

- include: "macosx.yml"
  when: ansible_distribution == "MacOSX"

- name: Ensure spacemacs is installed for {{ user.name }}
  git: >
    dest="{{ user.home }}/.emacs.d"
    repo=https://github.com/syl20bnr/spacemacs.git
    version=v0.200.9
    depth=1
    force=no
    update=no
  become: yes
  become_user: "{{ user.name }}"

- include: "{{ playbook_dir }}/shared_tasks/dotfiles.yml"

- name: Initialize spacemacs packages
  command: emacs --batch -l {{ user.home }}/.emacs.d/init.el
  args:
    chdir: "{{ user.home }}/.emacs.d"
  become: yes
  become_user: "{{ user.name }}"
  when: synchronize_dotfiles.changed
